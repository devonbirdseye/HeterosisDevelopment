---
title: "LeafSectionExperiments"
author: "Devon Birdseye"
date: '2023-05-17'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r packages}
library(factoextra)
library(dplyr)
library(ggbiplot)
library(reshape2)
library(ggridges)
```
```{r mgdb}
#Downloaded from MaizeGDB 2020/05/18, 07:11pm
mgdb <- read.csv("mgdb.csv", stringsAsFactors = F, header = F)
colnames(mgdb) <- mgdb[5,]
mgdb <- mgdb[-c(1:5),]
```
```{r Genes Of Interest}
GOIs <- readRDS("GOIs")
```
#Experiment 1
##import data
```{r import}
tmt <- read.csv("B73x5-Mo17x5-BMx5 leaf sections TMT15 111521.csv", stringsAsFactors = F)

tmt$Gene <- substr(tmt$Accession, start = 1, stop = 14)
```
```{r remove unwanted data}
n <- nrow(tmt)
print(c("total proteins =", n), quote = F)
#remove non-maize proteins
tmt <- tmt[(grep("Zm|Zema|Zeam", tmt$Accession)),]
n2 <- nrow(tmt)
print(c("non-maize proteins removed =", (n-n2)), quote = F)
#remove polymorphic proteins
tmt.pm <- tmt[grep("only", tmt$Accession),]
tmt <- tmt[-grep("only", tmt$Accession),]
n3 <- nrow(tmt)
print(c("polymorphic proteins removed =", (n2-n3)), quote = F)
#remove rows with missing tmt data
for(i in 2:16){
tmt <- tmt[!tmt[,i]==0,]
}
n4 <- nrow(tmt)
print(c("proteins with missing data removed =", (n3-n4)), quote = F)
print(c("remaining proteins =", n4), quote = F)
```
```{r add Entrez numbers}
Entrez <- readRDS("Entrez")
#add Entrez to data
tmt <- join(x = tmt, y = Entrez, by = "Gene", type="left", match="first")

#check that none were missed
tmt[grep("Zema|Zeam", tmt$Gene),c("Gene","Entrez")]
```
##calculate ratios
```{r}
tmt$MP.1 <- rowMeans(tmt[,c("B73.1", "Mo17.1")])
tmt$MP.2 <- rowMeans(tmt[,c("B73.2", "Mo17.2")])
tmt$MP.3 <- rowMeans(tmt[,c("B73.3", "Mo17.3")])
tmt$MP.4 <- rowMeans(tmt[,c("B73.4", "Mo17.4")])
tmt$MP.5 <- rowMeans(tmt[,c("B73.5", "Mo17.5")])

tmt$l2.BM.1.MP.1 <- log2(tmt$BM.1/tmt$MP.1)
tmt$l2.BM.2.MP.2 <- log2(tmt$BM.2/tmt$MP.2)
tmt$l2.BM.3.MP.3 <- log2(tmt$BM.3/tmt$MP.3)
tmt$l2.BM.4.MP.4 <- log2(tmt$BM.4/tmt$MP.4)
tmt$l2.BM.5.MP.5 <- log2(tmt$BM.5/tmt$MP.5)

tmt$l2.B73.1.Mo17.1 <- log2(tmt$B73.1/tmt$Mo17.1)
tmt$l2.B73.2.Mo17.2 <- log2(tmt$B73.2/tmt$Mo17.2)
tmt$l2.B73.3.Mo17.3 <- log2(tmt$B73.3/tmt$Mo17.3)
tmt$l2.B73.4.Mo17.4 <- log2(tmt$B73.4/tmt$Mo17.4)
tmt$l2.B73.5.Mo17.5 <- log2(tmt$B73.5/tmt$Mo17.5)
```
##heatmaps
```{r plastid ribosome heat map}
#sort columns by genotype
tmt.pRibo.m <- as.matrix(tmt[tmt$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo),c(3:6,8:11,13:16)])
rownames(tmt.pRibo.m) <- tmt$Gene[tmt$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo)]
heatmap(tmt.pRibo.m, Colv = NA)
#sort columns by section
tmt.pRibo.m <- as.matrix(tmt[tmt$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo),c("B73.2","Mo17.2","BM.2","B73.3","Mo17.3","BM.3","B73.4","Mo17.4","BM.4","B73.5","Mo17.5","BM.5")])
rownames(tmt.pRibo.m) <- tmt$Gene[tmt$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo)]
heatmap(tmt.pRibo.m, Colv = NA)
```
```{r photosynthesis-associated heatmap}
#sort columns by genotype
tmt.PhAGs.m <- as.matrix(tmt[tmt$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs),c(3:6,8:11,13:16)])
rownames(tmt.PhAGs.m) <- tmt$Gene[tmt$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)]
heatmap(tmt.PhAGs.m, Colv = NA)
#sort columns by section
tmt.PhAGs.m <- as.matrix(tmt[tmt$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs),c("B73.2","Mo17.2","BM.2","B73.3","Mo17.3","BM.3","B73.4","Mo17.4","BM.4","B73.5","Mo17.5","BM.5")])
rownames(tmt.PhAGs.m) <- tmt$Gene[tmt$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)]
heatmap(tmt.PhAGs.m, Colv = NA)
```
```{r plastid ribosome heatmap by ratios}
colnames(tmt)
tmt.pRibo.m <- as.matrix(tmt[tmt$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo),30:37])
rownames(tmt.pRibo.m) <- tmt$Gene[tmt$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo)]
colnames(tmt.pRibo.m) <- c("BM.1/MP.1", "BM.2/MP.2", "BM.3/MP.3", "BM.4/MP.4", "acs.1/B73.1", "acs.2/B73.2", "acs.3/B73.3", "acs.4/B73.4")
heatmap(tmt.pRibo.m, Colv = NA, cexCol = .8, cexRow = .4, col = colorspace::diverge_hsv(n = 12))
```

##Expression Heterosis Density Curves
```{r tmt.BM.MP sections 1-5}
tmt.BM.MP <- tmt[,c("Gene","l2.BM.1.MP.1", "l2.BM.2.MP.2","l2.BM.3.MP.3","l2.BM.4.MP.4","l2.BM.5.MP.5")]
colnames(tmt.BM.MP) <- c("Gene","Section1", "Section2","Section3","Section4","Section5")
tmt.BM.MP.m <- melt(tmt.BM.MP)

tmt.BM.MP.m$Category <- "Other"

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)] <- "PhANGs/PhAPGs"

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% c(GOIs$NE.PtRibo, GOIs$PE.ribo)] <- "Plastid ribosome"


tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$CytoRibo] <- "Cytosolic ribosome"


colors.p2 <- c("Other"="grey50",  "Plastid ribosome"="#6A00EA",  "PhANGs/PhAPGs"="#008275", "Cytosolic ribosome"="#B50000")

tmt.BM.MP.m$value[tmt.BM.MP.m$value <= -2] <- -2
tmt.BM.MP.m$value[tmt.BM.MP.m$value >= 2] <- 2

ggplot(tmt.BM.MP.m, mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p2, name="")+
  theme_ridges() +
  xlim(-2,2)+
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(BM/MP)")+
  guides(col=guide_legend(nrow = 2))+
  coord_cartesian(clip = "off", expand = F)
ggsave("tmt.BM.MP.png", width = 4, height = 5)
```
```{r tmt.BM.MP sections 2-5}
tmt.BM.MP <- tmt[,c("Gene","l2.BM.2.MP.2","l2.BM.3.MP.3","l2.BM.4.MP.4","l2.BM.5.MP.5")]
colnames(tmt.BM.MP) <- c("Gene","Section1", "Section2","Section3","Section4")
tmt.BM.MP.m <- melt(tmt.BM.MP)

tmt.BM.MP.m$Category <- "Other"

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)] <- "PhANGs/PhAPGs"

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% c(GOIs$NE.PtRibo, GOIs$PE.ribo)] <- "Plastid ribosome"


tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$CytoRibo] <- "Cytosolic ribosome"


colors.p2 <- c("Other"="grey50",  "Plastid ribosome"="#6A00EA",  "PhANGs/PhAPGs"="#008275", "Cytosolic ribosome"="#B50000")

tmt.BM.MP.m$value[tmt.BM.MP.m$value <= -2] <- -2
tmt.BM.MP.m$value[tmt.BM.MP.m$value >= 2] <- 2

ggplot(tmt.BM.MP.m, mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p2, name="")+
  theme_ridges() +
  xlim(-2,2)+
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(BM/MP)")+
  guides(col=guide_legend(nrow = 2))+
  coord_cartesian(clip = "off", expand = F)
ggsave("tmt.BM.MP.4sectionsOnly.png", width = 4, height = 5)
```
```{r tmt.BM.MP plastid digenomic complex proteins}
tmt.BM.MP <- tmt[,c("Accession","Gene","l2.BM.1.MP.1", "l2.BM.2.MP.2","l2.BM.3.MP.3","l2.BM.4.MP.4","l2.BM.5.MP.5")]
colnames(tmt.BM.MP) <- c("Accession","Gene","Section1","Section2","Section3","Section4","Section5")
tmt.BM.MP.m <- melt(tmt.BM.MP)

tmt.BM.MP.m$Category <- "Other"
tmt.BM.MP.m$Order <- 1

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$plastid] <- "Plastid-localized"
tmt.BM.MP.m$Order[tmt.BM.MP.m$Gene %in% GOIs$plastid] <- 2

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$PhANGs] <- "PhANGs"
tmt.BM.MP.m$Order[tmt.BM.MP.m$Gene %in% GOIs$PhANGs] <- 3

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$PhAPGs] <- "PhAPGs"
tmt.BM.MP.m$Order[tmt.BM.MP.m$Gene %in% GOIs$PhAPGs] <- 4

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$NE.PtRibo] <- "NE plastid ribosome"
tmt.BM.MP.m$Order[tmt.BM.MP.m$Gene %in% GOIs$NE.PtRibo] <- 5

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$PE.ribo] <- "PE plastid ribosome"
tmt.BM.MP.m$Order[tmt.BM.MP.m$Gene %in% GOIs$PE.ribo] <- 6

colors.p <- c("Other"="#656565", "Plastid-localized"="black", "PE plastid ribosome"="#6A00EA", "NE plastid ribosome"="#E5A3FF", "PhAPGs"="#008275", "PhANGs"="#81E401")

tmt.BM.MP.m$value[tmt.BM.MP.m$value > 2] <- 2
tmt.BM.MP.m$value[tmt.BM.MP.m$value < -2] <- -2

ggplot(tmt.BM.MP.m[tmt.BM.MP.m$Category %in% c("Plastid-localized","PhANGs","PhAPGs"),], mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p[c("Plastid-localized","PhANGs","PhAPGs")], name="")+
  theme_ridges() +
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(BM/MP)")+
  xlim(-2,2)
ggsave("LeafSections_PhAGs_BM_MP.jpg", width = 5, height = 6)

ggplot(tmt.BM.MP.m[tmt.BM.MP.m$Category %in% c("Plastid-localized","NE plastid ribosome","PE plastid ribosome"),], mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p[c("Plastid-localized","NE plastid ribosome","PE plastid ribosome")], name="")+
  theme_ridges() +
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(BM/MP)")+
  xlim(-2,2)
ggsave("LeafSections_pRibo_BM_MP.jpg", width = 5, height = 6)
```
```{r tmt.BM.MP Et Bio and Cyto Ribo}
tmt.BM.MP <- tmt[,c("Accession","Gene","l2.BM.1.MP.1", "l2.BM.2.MP.2","l2.BM.3.MP.3","l2.BM.4.MP.4","l2.BM.5.MP.5")]
colnames(tmt.BM.MP) <- c("Accession","Gene","Section1","Section2","Section3","Section4","Section5")
tmt.BM.MP.m <- melt(tmt.BM.MP)

tmt.BM.MP.m$Category <- "Other"
tmt.BM.MP.m$Order <- 1

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$EtBio] <- "Ethylene biosynthesis"
tmt.BM.MP.m$Order[tmt.BM.MP.m$Gene %in% GOIs$EtBio] <-2

tmt.BM.MP.m$Category[tmt.BM.MP.m$Gene %in% GOIs$CytoRibo] <- "Cytosolic ribosome"
tmt.BM.MP.m$Order[tmt.BM.MP.m$Gene %in% GOIs$CytoRibo] <-3

colors.p <- c("Other"="#656565",  "Cytosolic ribosome"="#B50000", "Ethylene biosynthesis"="#EF8F6D")

tmt.BM.MP.m$value[tmt.BM.MP.m$value > 2] <- 2
tmt.BM.MP.m$value[tmt.BM.MP.m$value < -2] <- -2


ggplot(tmt.BM.MP.m, mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p, name="")+
  theme_ridges() +
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(BM/MP)")+
  xlim(-2,2)
ggsave("LeafSections_Cyto_BM_MP.jpg", width = 5, height = 6)
```

##Parent expression density curves
```{r tmt.B73.Mo17}
tmt.B73.Mo17 <- tmt[,c("Accession","Gene","l2.B73.1.Mo17.1", "l2.B73.2.Mo17.2","l2.B73.3.Mo17.3","l2.B73.4.Mo17.4","l2.B73.5.Mo17.5")]
colnames(tmt.B73.Mo17) <- c("Accession","Gene","Section1","Section2","Section3","Section4","Section5")
tmt.B73.Mo17.m <- melt(tmt.B73.Mo17)

tmt.B73.Mo17.m$Category <- "Other"
tmt.B73.Mo17.m$Order <- 1

tmt.B73.Mo17.m$Category[tmt.B73.Mo17.m$Gene %in% GOIs$plastid] <- "Plastid-localized"
tmt.B73.Mo17.m$Order[tmt.B73.Mo17.m$Gene %in% GOIs$plastid] <- 2

tmt.B73.Mo17.m$Category[tmt.B73.Mo17.m$Gene %in% GOIs$PhANGs] <- "PhANGs"
tmt.B73.Mo17.m$Order[tmt.B73.Mo17.m$Gene %in% GOIs$PhANGs] <- 3

tmt.B73.Mo17.m$Category[tmt.B73.Mo17.m$Gene %in% GOIs$PhAPGs] <- "PhAPGs"
tmt.B73.Mo17.m$Order[tmt.B73.Mo17.m$Gene %in% GOIs$PhAPGs] <- 4

tmt.B73.Mo17.m$Category[tmt.B73.Mo17.m$Gene %in% GOIs$NE.PtRibo] <- "NE plastid ribosome"
tmt.B73.Mo17.m$Order[tmt.B73.Mo17.m$Gene %in% GOIs$NE.PtRibo] <- 5

tmt.B73.Mo17.m$Category[tmt.B73.Mo17.m$Gene %in% GOIs$PE.ribo] <- "PE plastid ribosome"
tmt.B73.Mo17.m$Order[tmt.B73.Mo17.m$Gene %in% GOIs$PE.ribo] <- 6

tmt.B73.Mo17.m$Category[tmt.B73.Mo17.m$Gene %in% GOIs$EtBio] <- "Ethylene biosynthesis"
tmt.B73.Mo17.m$Order[tmt.B73.Mo17.m$Gene %in% GOIs$EtBio] <-7

tmt.B73.Mo17.m$Category[tmt.B73.Mo17.m$Gene %in% GOIs$CytoRibo] <- "Cytosolic ribosome"
tmt.B73.Mo17.m$Order[tmt.B73.Mo17.m$Gene %in% GOIs$CytoRibo] <-8

colors.p <- c("Other"="#656565", "Plastid-localized"="black", "Cytosolic ribosome"="#B50000", "PE plastid ribosome"="#6A00EA", "NE plastid ribosome"="#E5A3FF", "PhAPGs"="#008275", "PhANGs"="#81E401", "Ethylene biosynthesis"="#EF8F6D")

tmt.B73.Mo17.m$value[tmt.B73.Mo17.m$value > 2] <- 2
tmt.B73.Mo17.m$value[tmt.B73.Mo17.m$value < -2] <- -2

ggplot(tmt.B73.Mo17.m[tmt.B73.Mo17.m$Category %in% c("Plastid-localized","PhANGs","PhAPGs"),], mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p[c("Plastid-localized","PhANGs","PhAPGs")], name="")+
  theme_ridges() +
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(B73/Mo17)")+
  xlim(-2,2)
ggsave("LeafSections_PhAGs_B73_Mo17.jpg", width = 5, height = 6)

ggplot(tmt.B73.Mo17.m[tmt.B73.Mo17.m$Category %in% c("Plastid-localized","NE plastid ribosome","PE plastid ribosome"),], mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p[c("Plastid-localized","NE plastid ribosome","PE plastid ribosome")], name="")+
  theme_ridges() +
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(B73/Mo17)")+
  xlim(-2,2)
ggsave("LeafSections_pRibo_B73_Mo17.jpg", width = 5, height = 6)

ggplot(tmt.B73.Mo17.m[tmt.B73.Mo17.m$Category %in% c("Other","Cytosolic ribosome","Ethylene biosynthesis"),], mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p[c("Other","Cytosolic ribosome","Ethylene biosynthesis")], name="")+
  theme_ridges() +
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(B73/Mo17)")+
  xlim(-2,2)
ggsave("LeafSections_Cyto_B73_Mo17.jpg", width = 5, height = 6)
```

##PCA
```{r}
colnames(tmt)
tmt.pca <- t(tmt[,2:16])
colnames(tmt.pca) <- tmt$Accession
tmt.pca <- scale(tmt.pca, scale = T, center = F)
tmt.pca <- prcomp(tmt.pca)
```
```{r}
fviz_eig(tmt.pca, addlabels = TRUE)
#ggsave("LeafSectionsScree.png", width = 7, height = 5)
```
```{r}
tmt.gt <- c(rep("B73",5), rep("Mo17",5), rep("BxM",5))
```
```{r}
ggbiplot(tmt.pca, var.axes = F, labels = colnames(tmt[,2:16]), groups = tmt.gt)+
  theme_bw()+
  theme(legend.position = "none")
#ggsave("LeafSectionsPCA.png", width = 4, height = 4)
```
```{r}
tmt.pca.var <- get_pca_var(tmt.pca)
tmt.pca.var.contrib <- as.data.frame(tmt.pca.var$contrib)


tmt.pca.var.contrib$Accession <- rownames(tmt.pca.var.contrib)
tmt.pca.var.contrib$Gene <- substr(tmt.pca.var.contrib$Accession, start = 1, stop = 14)
tmt.pca.var.contrib$Category <- "Other"
tmt.pca.var.contrib$Category[tmt.pca.var.contrib$Gene %in% GOIs$plastid] <- "Plastid-localized"
tmt.pca.var.contrib$Category[tmt.pca.var.contrib$Gene %in% GOIs$PhANGs] <- "PhANGs"
tmt.pca.var.contrib$Category[tmt.pca.var.contrib$Gene %in% GOIs$PhAPGs] <- "PhAPGs"
tmt.pca.var.contrib$Category[tmt.pca.var.contrib$Gene %in% GOIs$NE.PtRibo] <- "NE plastid ribosome"
tmt.pca.var.contrib$Category[tmt.pca.var.contrib$Gene %in% GOIs$PE.ribo] <- "PE plastid ribosome"
tmt.pca.var.contrib$Category[tmt.pca.var.contrib$Gene %in% GOIs$EtBio] <- "Ethylene biosynthesis"

tmt.pca.var.contrib.Dim1 <- merge.data.frame(tmt.pca.var.contrib[,c("Accession", "Category", "Dim.1")], tmt[,c("Accession", "Gene", "Entrez", "Protein")], by.x = "Accession", by.y = "Accession", all.x = T, all.y = F)
tmt.pca.var.contrib.Dim1 <- tmt.pca.var.contrib.Dim1[order(-tmt.pca.var.contrib.Dim1$Dim.1),]
write.csv(tmt.pca.var.contrib.Dim1, row.names = F, "tmt.pca.var.contrib.Dim1.csv")

tmt.pca.var.contrib.Dim2 <- merge.data.frame(tmt.pca.var.contrib[,c("Accession", "Category", "Dim.2")], tmt[,c("Accession", "Gene", "Entrez", "Protein")], by.x = "Accession", by.y = "Accession", all.x = T, all.y = F)
tmt.pca.var.contrib.Dim2 <- tmt.pca.var.contrib.Dim2[order(-tmt.pca.var.contrib.Dim2$Dim.2),]
write.csv(tmt.pca.var.contrib.Dim2, row.names = F, "tmt.pca.var.contrib.Dim2.csv")
```
```{r}
tmt.pca.var.contrib$Category <- factor(tmt.pca.var.contrib$Category, levels = c("Other", "Plastid-localized", "Ethylene biosynthesis","PE plastid ribosome", "NE plastid ribosome", "PhAPGs","PhANGs"))
ggplot(tmt.pca.var.contrib, mapping=aes(y=Category, x=Dim.1, fill = stat(x)))+
  geom_density_ridges_gradient(size=1) +
  scale_fill_viridis_c(option = "C")+
  theme_ridges() +
  theme(axis.text =element_text(size=8), axis.title = element_text(size=8), legend.position = "none", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=8))+
  xlim(0,max(tmt.pca.var.contrib$Dim.1))+
  coord_cartesian(expand = F)
```
```{r}
ggplot(tmt.pca.var.contrib, mapping=aes(y=Category, x=Dim.2, fill = stat(x)))+
  geom_density_ridges_gradient(alpha=0.7) +
  scale_fill_viridis_c(option = "B")+
  theme_ridges() +
  theme(axis.text =element_text(size=8), axis.title = element_text(size=8), legend.position = "none", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=8))
```
#Experiment 4
##Import
```{r import data}
tmt4 <- read.csv("B-M-H-A leaf section 050123.csv", stringsAsFactors = F)

tmt4 <- tmt4[,c(17:23,1:16)]

colnames(tmt4)[8:23] <- c("B.1","B.2","B.3","B.4","M.1","M.2","M.3","M.4","H.1","H.2","H.3","H.4","A.1","A.2","A.3","A.4")

tmt4$Gene <- substr(tmt4$Accession, start = 1, stop = 14)

tmt4 <- tmt4[,c(24,1:23)]
colnames(tmt4)
```
```{r remove unwanted data}
n <- nrow(tmt4)
print(c("total proteins =", n), quote = F)
#remove non-maize proteins
tmt4 <- tmt4[(grep("Zm|Zema|Zeam", tmt4$Accession)),]
n2 <- nrow(tmt4)
print(c("non-maize proteins removed =", (n-n2)), quote = F)
#remove polymorphic proteins
tmt4.pm <- tmt4[grep("only", tmt4$Accession),]
tmt4 <- tmt4[-grep("only", tmt4$Accession),]
n3 <- nrow(tmt4)
print(c("polymorphic proteins removed =", (n2-n3)), quote = F)
#remove rows with missing tmt4 data
for(i in 9:24){
tmt4 <- tmt4[!tmt4[,i]==0,]
}
n4 <- nrow(tmt4)
print(c("proteins with missing data removed =", (n3-n4)), quote = F)
print(c("remaining proteins =", n4), quote = F)
```

##Add Entrez numbers
```{r add Entrez}
Entrez <- readRDS("Entrez")
#add Entrez to data
tmt4 <- join(x = tmt4, y = Entrez, by = "Gene", type="left", match="first")

#check that none were missed
tmt4[grep("Zema|Zeam", tmt4$Gene),c("Gene","Entrez")]
```
##Calculate ratios
```{r calculate ratios}
tmt4$MP.1 <- rowMeans(tmt4[,c("B.1","M.1")])
tmt4$MP.2 <- rowMeans(tmt4[,c("B.2","M.2")])
tmt4$MP.3 <- rowMeans(tmt4[,c("B.3","M.3")])
tmt4$MP.4 <- rowMeans(tmt4[,c("B.4","M.4")])

tmt4$l2.H1.MP1 <- log2(tmt4$H.1/tmt4$MP.1)
tmt4$l2.H2.MP2 <- log2(tmt4$H.2/tmt4$MP.2)
tmt4$l2.H3.MP3 <- log2(tmt4$H.3/tmt4$MP.3)
tmt4$l2.H4.MP4 <- log2(tmt4$H.4/tmt4$MP.4)

tmt4$l2.A1.B1 <- log2(tmt4$A.1/tmt4$B.1)
tmt4$l2.A2.B2 <- log2(tmt4$A.2/tmt4$B.2)
tmt4$l2.A3.B3 <- log2(tmt4$A.3/tmt4$B.3)
tmt4$l2.A4.B4 <- log2(tmt4$A.4/tmt4$B.4)

tmt4$l2.B1.M1 <- log2(tmt4$B.1/tmt4$M.1)
tmt4$l2.B2.M2 <- log2(tmt4$B.2/tmt4$M.2)
tmt4$l2.B3.M3 <- log2(tmt4$B.3/tmt4$M.3)
tmt4$l2.B4.M4 <- log2(tmt4$B.4/tmt4$M.4)
```
##Density plots
```{r BM/MP density}
tmt4.BM.MP <- tmt4[,c("Accession","Gene","l2.H1.MP1", "l2.H2.MP2", "l2.H3.MP3","l2.H4.MP4")]
colnames(tmt4.BM.MP) <- c("Accession","Gene","Section1", "Section2","Section3","Section4")
tmt4.BM.MP.m <- melt(tmt4.BM.MP)

tmt4.BM.MP.m$Category <- "Other"

tmt4.BM.MP.m$Category[tmt4.BM.MP.m$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)] <- "PhANGs/PhAPGs"

tmt4.BM.MP.m$Category[tmt4.BM.MP.m$Gene %in% c(GOIs$NE.PtRibo, GOIs$PE.ribo)] <- "Plastid ribosome"

tmt4.BM.MP.m$Category[tmt4.BM.MP.m$Gene %in% GOIs$CytoRibo] <- "Cytosolic ribosome"


colors.p2 <- c("Other"="grey50",  "Plastid ribosome"="#6A00EA",  "PhANGs/PhAPGs"="#008275", "Cytosolic ribosome"="#B50000")

tmt4.BM.MP.m$value[tmt4.BM.MP.m$value <= -2] <- -2
tmt4.BM.MP.m$value[tmt4.BM.MP.m$value >= 2] <- 2

ggplot(tmt4.BM.MP.m, mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p2, name="")+
  theme_ridges() +
  xlim(-2,2)+
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(BM/MP)")+
  guides(col=guide_legend(nrow = 2))+
  coord_cartesian(clip = "off", expand = F)
ggsave("tmt4.BM.MP.png", width = 4, height = 5)
```
```{r acs/B73 density}
tmt4.acs.B73 <- tmt4[,c("Accession","Gene","l2.A1.B1","l2.A2.B2", "l2.A3.B3","l2.A4.B4")]
colnames(tmt4.acs.B73) <- c("Accession","Gene","Section1", "Section2","Section3","Section4")
tmt4.acs.B73.m <- melt(tmt4.acs.B73)

tmt4.acs.B73.m$Category <- "Other"

tmt4.acs.B73.m$Category[tmt4.acs.B73.m$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)] <- "PhANGs/PhAPGs"

tmt4.acs.B73.m$Category[tmt4.acs.B73.m$Gene %in% c(GOIs$NE.PtRibo, GOIs$PE.ribo)] <- "Plastid ribosome"

tmt4.acs.B73.m$Category[tmt4.acs.B73.m$Gene %in% GOIs$CytoRibo] <- "Cytosolic ribosome"

colors.p2 <- c("Other"="grey50",  "Plastid ribosome"="#6A00EA",  "PhANGs/PhAPGs"="#008275", "Cytosolic ribosome"="#B50000")

tmt4.acs.B73.m$value[tmt4.acs.B73.m$value <= -2] <- -2
tmt4.acs.B73.m$value[tmt4.acs.B73.m$value >= 2] <- 2

ggplot(tmt4.acs.B73.m, mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p2, name="")+
  theme_ridges() +
  xlim(-2,2)+
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(acs/B73)")+
  guides(col=guide_legend(nrow = 2))+
  coord_cartesian(clip = "off", expand = F)
ggsave("tmt4.acs.B73.png", width = 4, height = 5)
```
```{r B73/Mo17 density}
tmt4.B73.Mo17 <- tmt4[,c("Accession","Gene","l2.B1.M1", "l2.B2.M2", "l2.B3.M3","l2.B4.M4")]
colnames(tmt4.B73.Mo17) <- c("Accession","Gene","Section1", "Section2","Section3","Section4")
tmt4.B73.Mo17.m <- melt(tmt4.B73.Mo17)

tmt4.B73.Mo17.m$Category <- "Other"

tmt4.B73.Mo17.m$Category[tmt4.B73.Mo17.m$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)] <- "PhANGs/PhAPGs"

tmt4.B73.Mo17.m$Category[tmt4.B73.Mo17.m$Gene %in% c(GOIs$NE.PtRibo, GOIs$PE.ribo)] <- "Plastid ribosome"

tmt4.B73.Mo17.m$Category[tmt4.B73.Mo17.m$Gene %in% GOIs$CytoRibo] <- "Cytosolic ribosome"


colors.p2 <- c("Other"="grey50",  "Plastid ribosome"="#6A00EA",  "PhANGs/PhAPGs"="#008275", "Cytosolic ribosome"="#B50000")

tmt4.B73.Mo17.m$value[tmt4.B73.Mo17.m$value <= -2] <- -2
tmt4.B73.Mo17.m$value[tmt4.B73.Mo17.m$value >= 2] <- 2

ggplot(tmt4.B73.Mo17.m, mapping=aes(y=variable, x=value, color=Category))+
  geom_density_ridges(fill=NA, size=1, scale=1) +
  scale_color_manual(values = colors.p2, name="")+
  theme_ridges() +
  xlim(-2,2)+
  theme(legend.position = "bottom", axis.title.y = element_blank(), axis.title.x = element_text(hjust = 0.5, size=12), legend.text = element_text(size=9),)+
  geom_vline(xintercept = 0,  color="black", size=1)+
  xlab("log2(B73/M017)")+
  guides(col=guide_legend(nrow = 2))+
  coord_cartesian(clip = "off", expand = F)
ggsave("tmt4.B73.Mo17.png", width = 4, height = 5)
```
##Heatmaps
###All Genes
```{r}
library(RColorBrewer)
```

```{r all genes heatmap by clustering}
tmt4.m <- as.matrix(tmt4[,9:24])
rownames(tmt4.m) <- tmt4$Gene
heatmap(tmt4.m)
```
###pRibo
```{r plastid ribosome heatmap by genotype}
tmt4.pRibo.m <- as.matrix(tmt4[tmt4$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo),9:24])
rownames(tmt4.pRibo.m) <- tmt4$Gene[tmt4$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo)]
heatmap(tmt4.pRibo.m, Colv = NA, cexCol = .8, cexRow = .4)
```
```{r plastid ribosome heatmap by section}
tmt4.pRibo.m <- as.matrix(tmt4[tmt4$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo),c("B.1","M.1","H.1","A.1","B.2","M.2","H.2","A.2","B.3","M.3","H.3","A.3","B.4","M.4","H.4","A.4")])
rownames(tmt4.pRibo.m) <- tmt4$Gene[tmt4$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo)]
heatmap(tmt4.pRibo.m, Colv = NA, cexCol = .8, cexRow = .4)
```
```{r plastid ribosome heatmap by ratios}
tmt4.pRibo.m <- as.matrix(tmt4[tmt4$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo),30:37])
rownames(tmt4.pRibo.m) <- tmt4$Gene[tmt4$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo)]
colnames(tmt4.pRibo.m) <- c("BM.1/MP.1", "BM.2/MP.2", "BM.3/MP.3", "BM.4/MP.4", "acs.1/B73.1", "acs.2/B73.2", "acs.3/B73.3", "acs.4/B73.4")
heatmap(tmt4.pRibo.m, Colv = NA, cexCol = .8, cexRow = .4, col = colorspace::diverge_hsv(n = 12))
```
###PhAGs
```{r photosynthesis-associated heatmap by genotype}
tmt4.PhAGs.m <- as.matrix(tmt4[tmt4$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs),9:24])
rownames(tmt4.PhAGs.m) <- tmt4$Gene[tmt4$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)]
heatmap(tmt4.PhAGs.m, Colv = NA, cexCol = .8, cexRow = .2)
```
```{r photosynthesis-associated heatmap by section}
tmt4.PhAGs.m <- as.matrix(tmt4[tmt4$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs),c("B.1","M.1","H.1","A.1","B.2","M.2","H.2","A.2","B.3","M.3","H.3","A.3","B.4","M.4","H.4","A.4")])
rownames(tmt4.PhAGs.m) <- tmt4$Gene[tmt4$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)]
heatmap(tmt4.PhAGs.m, Colv = NA, cexCol = .8, cexRow = .2)
```
```{r photosynthesis-associated heatmap by ratios}
tmt4.PhAGs.m <- as.matrix(tmt4[tmt4$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs),30:37])
rownames(tmt4.PhAGs.m) <- tmt4$Gene[tmt4$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)]
colnames(tmt4.PhAGs.m) <- c("BM.1/MP.1", "BM.2/MP.2", "BM.3/MP.3", "BM.4/MP.4", "acs.1/B73.1", "acs.2/B73.2", "acs.3/B73.3", "acs.4/B73.4")
heatmap(tmt4.PhAGs.m, Colv = NA, cexCol = .8, cexRow = .2, col = colorspace::diverge_hsv(n = 12))
```


#Experiment 4 - non-normalized
##Import
```{r import data}
tmt4.nn <- read.csv("B-M-H-A leaf section 050123.csv", stringsAsFactors = F)

tmt4.nn <- tmt4.nn[,c(17:23,1:16)]

colnames(tmt4.nn)[8:23] <- c("B.1","B.2","B.3","B.4","M.1","M.2","M.3","M.4","H.1","H.2","H.3","H.4","A.1","A.2","A.3","A.4")

tmt4.nn$Gene <- substr(tmt4.nn$Accession, start = 1, stop = 14)

tmt4.nn <- tmt4.nn[,c(24,1:23)]
colnames(tmt4.nn)
```
```{r remove unwanted data}
n <- nrow(tmt4.nn)
print(c("total proteins =", n), quote = F)
#remove non-maize proteins
tmt4.nn <- tmt4.nn[(grep("Zm|Zema|Zeam", tmt4.nn$Accession)),]
n2 <- nrow(tmt4.nn)
print(c("non-maize proteins removed =", (n-n2)), quote = F)
#remove polymorphic proteins
tmt4.nn.pm <- tmt4.nn[grep("only", tmt4.nn$Accession),]
tmt4.nn <- tmt4.nn[-grep("only", tmt4.nn$Accession),]
n3 <- nrow(tmt4.nn)
print(c("polymorphic proteins removed =", (n2-n3)), quote = F)
#remove rows with missing tmt4.nn data
for(i in 9:24){
tmt4.nn <- tmt4.nn[!tmt4.nn[,i]==0,]
}
n4 <- nrow(tmt4.nn)
print(c("proteins with missing data removed =", (n3-n4)), quote = F)
print(c("remaining proteins =", n4), quote = F)
```

##Heatmaps
###All Genes
```{r}
library(RColorBrewer)
```

```{r all genes heatmap by clustering}
tmt4.nn.m <- as.matrix(tmt4.nn[,9:24])
rownames(tmt4.nn.m) <- tmt4.nn$Gene
heatmap(tmt4.nn.m)
```
###pRibo
```{r plastid ribosome heatmap by genotype}
tmt4.nn.pRibo.m <- as.matrix(tmt4.nn[tmt4.nn$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo),9:24])
rownames(tmt4.nn.pRibo.m) <- tmt4.nn$Gene[tmt4.nn$Gene %in% c(GOIs$PE.ribo, GOIs$NE.PtRibo)]
heatmap(tmt4.nn.pRibo.m, Colv = NA, cexCol = .8, cexRow = .4)
```
###PhAGs
```{r photosynthesis-associated heatmap by genotype}
tmt4.nn.PhAGs.m <- as.matrix(tmt4.nn[tmt4.nn$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs),9:24])
rownames(tmt4.nn.PhAGs.m) <- tmt4.nn$Gene[tmt4.nn$Gene %in% c(GOIs$PhANGs, GOIs$PhAPGs)]
heatmap(tmt4.nn.PhAGs.m, Colv = NA, cexCol = .8, cexRow = .2)
```

